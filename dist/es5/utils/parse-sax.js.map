{"version":3,"sources":["../../../lib/utils/parse-sax.js"],"names":["require","SaxesParser","PassThrough","module","exports","iterable","pipe","Symbol","asyncIterator","saxesParser","on","err","error","events","value","push","eventType","chunk","write","toString"],"mappings":";;;;;;;;;;;;;;;;;;;;eAAsBA,OAAO,CAAC,OAAD,C;IAAtBC,W,YAAAA,W;;gBACeD,OAAO,CAAC,iBAAD,C;IAAtBE,W,aAAAA,W;;AAEPC,MAAM,CAACC,OAAP;AAAA,uEAAiB,iBAAgBC,QAAhB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACf;AACA;AACA,gBAAIA,QAAQ,CAACC,IAAT,IAAiB,CAACD,QAAQ,CAACE,MAAM,CAACC,aAAR,CAA9B,EAAsD;AACpDH,cAAAA,QAAQ,GAAGA,QAAQ,CAACC,IAAT,CAAc,IAAIJ,WAAJ,EAAd,CAAX;AACD;;AACKO,YAAAA,WANS,GAMK,IAAIR,WAAJ,EANL;AAQfQ,YAAAA,WAAW,CAACC,EAAZ,CAAe,OAAf,EAAwB,UAAAC,GAAG,EAAI;AAC7BC,cAAAA,KAAK,GAAGD,GAAR;AACD,aAFD;AAGIE,YAAAA,MAXW,GAWF,EAXE;AAYfJ,YAAAA,WAAW,CAACC,EAAZ,CAAe,SAAf,EAA0B,UAAAI,KAAK;AAAA,qBAAID,MAAM,CAACE,IAAP,CAAY;AAACC,gBAAAA,SAAS,EAAE,SAAZ;AAAuBF,gBAAAA,KAAK,EAALA;AAAvB,eAAZ,CAAJ;AAAA,aAA/B;AACAL,YAAAA,WAAW,CAACC,EAAZ,CAAe,MAAf,EAAuB,UAAAI,KAAK;AAAA,qBAAID,MAAM,CAACE,IAAP,CAAY;AAACC,gBAAAA,SAAS,EAAE,MAAZ;AAAoBF,gBAAAA,KAAK,EAALA;AAApB,eAAZ,CAAJ;AAAA,aAA5B;AACAL,YAAAA,WAAW,CAACC,EAAZ,CAAe,UAAf,EAA2B,UAAAI,KAAK;AAAA,qBAAID,MAAM,CAACE,IAAP,CAAY;AAACC,gBAAAA,SAAS,EAAE,UAAZ;AAAwBF,gBAAAA,KAAK,EAALA;AAAxB,eAAZ,CAAJ;AAAA,aAAhC;AAde;AAAA;AAAA;AAAA,uCAeWT,QAfX;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAeEY,YAAAA,KAfF;AAgBbR,YAAAA,WAAW,CAACS,KAAZ,CAAkBD,KAAK,CAACE,QAAN,EAAlB,EAhBa,CAiBb;AACA;;AAlBa,iBAmBTP,KAnBS;AAAA;AAAA;AAAA;;AAAA,kBAmBIA,KAnBJ;;AAAA;AAAA;AAsBb,mBAAMC,MAAN;;AAtBa;AAuBbA,YAAAA,MAAM,GAAG,EAAT;;AAvBa;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjB;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const {SaxesParser} = require('saxes');\nconst {PassThrough} = require('readable-stream');\n\nmodule.exports = async function*(iterable) {\n  // TODO: Remove once node v8 is deprecated\n  // Detect and upgrade old streams\n  if (iterable.pipe && !iterable[Symbol.asyncIterator]) {\n    iterable = iterable.pipe(new PassThrough());\n  }\n  const saxesParser = new SaxesParser();\n  let error;\n  saxesParser.on('error', err => {\n    error = err;\n  });\n  let events = [];\n  saxesParser.on('opentag', value => events.push({eventType: 'opentag', value}));\n  saxesParser.on('text', value => events.push({eventType: 'text', value}));\n  saxesParser.on('closetag', value => events.push({eventType: 'closetag', value}));\n  for await (const chunk of iterable) {\n    saxesParser.write(chunk.toString());\n    // saxesParser.write and saxesParser.on() are synchronous,\n    // so we can only reach the below line once all events have been emitted\n    if (error) throw error;\n    // As a performance optimization, we gather all events instead of passing\n    // them one by one, which would cause each event to go through the event queue\n    yield events;\n    events = [];\n  }\n};\n"],"file":"parse-sax.js"}