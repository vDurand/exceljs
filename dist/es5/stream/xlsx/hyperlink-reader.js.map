{"version":3,"sources":["../../../../lib/stream/xlsx/hyperlink-reader.js"],"names":["require","EventEmitter","parseSax","Enums","RelType","HyperlinkReader","workbook","id","iterator","options","fn","hyperlinks","forEach","emitHyperlinks","emit","events","eventType","value","node","name","rId","attributes","Id","Type","Hyperlink","relationship","type","RelationshipType","Styles","target","Target","targetMode","TargetMode","length","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAAuBA,OAAO,CAAC,QAAD,C;IAAvBC,Y,YAAAA,Y;;AACP,IAAMC,QAAQ,GAAGF,OAAO,CAAC,uBAAD,CAAxB;;AAEA,IAAMG,KAAK,GAAGH,OAAO,CAAC,iBAAD,CAArB;;AACA,IAAMI,OAAO,GAAGJ,OAAO,CAAC,qBAAD,CAAvB;;IAEMK,e;;;;;AACJ,iCAA+C;AAAA;;AAAA,QAAlCC,QAAkC,QAAlCA,QAAkC;AAAA,QAAxBC,EAAwB,QAAxBA,EAAwB;AAAA,QAApBC,QAAoB,QAApBA,QAAoB;AAAA,QAAVC,OAAU,QAAVA,OAAU;;AAAA;;AAC7C;AAEA,UAAKH,QAAL,GAAgBA,QAAhB;AACA,UAAKC,EAAL,GAAUA,EAAV;AACA,UAAKC,QAAL,GAAgBA,QAAhB;AACA,UAAKC,OAAL,GAAeA,OAAf;AAN6C;AAO9C;;;;yBAMIC,E,EAAI;AACP,aAAO,KAAKC,UAAL,CAAgBC,OAAhB,CAAwBF,EAAxB,CAAP;AACD;;;;;;;;;;;AAGQF,gBAAAA,Q,GAAqB,I,CAArBA,Q,EAAUC,O,GAAW,I,CAAXA,O;AACbI,gBAAAA,c,GAAiB,K;AACjBF,gBAAAA,U,GAAa,I;8BACTF,OAAO,CAACE,U;gDACT,M,uBAGA,O;;;;AAFHE,gBAAAA,cAAc,GAAG,IAAjB;;;;AAGA,qBAAKF,UAAL,GAAkBA,UAAU,GAAG,EAA/B;;;;;;;sBAMA,CAACE,cAAD,IAAmB,CAACF,U;;;;;AACtB,qBAAKG,IAAL,CAAU,UAAV;;;;;;;;2CAK2BZ,QAAQ,CAACM,QAAD,C;;;;;;;;;;;;;;;;;;;;AAAlBO,gBAAAA,M;wDACkBA,M;;;;;;;;;;;6CAArBC,S,gBAAAA,S,EAAWC,K,gBAAAA,K;;sBACjBD,SAAS,KAAK,S;;;;;AACVE,gBAAAA,I,GAAOD,K;;sBACTC,IAAI,CAACC,IAAL,KAAc,c;;;;;AACVC,gBAAAA,G,GAAMF,IAAI,CAACG,UAAL,CAAgBC,E;8BACpBJ,IAAI,CAACG,UAAL,CAAgBE,I;gDACjBnB,OAAO,CAACoB,S;;;;AAEHC,gBAAAA,Y,GAAe;AACnBC,kBAAAA,IAAI,EAAEvB,KAAK,CAACwB,gBAAN,CAAuBC,MADV;AAEnBR,kBAAAA,GAAG,EAAHA,GAFmB;AAGnBS,kBAAAA,MAAM,EAAEX,IAAI,CAACG,UAAL,CAAgBS,MAHL;AAInBC,kBAAAA,UAAU,EAAEb,IAAI,CAACG,UAAL,CAAgBW;AAJT,iB;;AAMrB,oBAAInB,cAAJ,EAAoB;AAClB,uBAAKC,IAAL,CAAU,WAAV,EAAuBW,YAAvB;AACD,iBAFD,MAEO;AACLd,kBAAAA,UAAU,CAACc,YAAY,CAACL,GAAd,CAAV,GAA+BK,YAA/B;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWf,qBAAKX,IAAL,CAAU,UAAV;;;;;;;AAEA,qBAAKA,IAAL,CAAU,OAAV;;;;;;;;;;;;;;;;;;wBA7DQ;AACV,aAAQ,KAAKH,UAAL,IAAmB,KAAKA,UAAL,CAAgBsB,MAApC,IAA+C,CAAtD;AACD;;;;EAZ2BhC,Y;;AA4E9BiC,MAAM,CAACC,OAAP,GAAiB9B,eAAjB","sourcesContent":["const {EventEmitter} = require('events');\nconst parseSax = require('../../utils/parse-sax');\n\nconst Enums = require('../../doc/enums');\nconst RelType = require('../../xlsx/rel-type');\n\nclass HyperlinkReader extends EventEmitter {\n  constructor({workbook, id, iterator, options}) {\n    super();\n\n    this.workbook = workbook;\n    this.id = id;\n    this.iterator = iterator;\n    this.options = options;\n  }\n\n  get count() {\n    return (this.hyperlinks && this.hyperlinks.length) || 0;\n  }\n\n  each(fn) {\n    return this.hyperlinks.forEach(fn);\n  }\n\n  async read() {\n    const {iterator, options} = this;\n    let emitHyperlinks = false;\n    let hyperlinks = null;\n    switch (options.hyperlinks) {\n      case 'emit':\n        emitHyperlinks = true;\n        break;\n      case 'cache':\n        this.hyperlinks = hyperlinks = {};\n        break;\n      default:\n        break;\n    }\n\n    if (!emitHyperlinks && !hyperlinks) {\n      this.emit('finished');\n      return;\n    }\n\n    try {\n      for await (const events of parseSax(iterator)) {\n        for (const {eventType, value} of events) {\n          if (eventType === 'opentag') {\n            const node = value;\n            if (node.name === 'Relationship') {\n              const rId = node.attributes.Id;\n              switch (node.attributes.Type) {\n                case RelType.Hyperlink:\n                  {\n                    const relationship = {\n                      type: Enums.RelationshipType.Styles,\n                      rId,\n                      target: node.attributes.Target,\n                      targetMode: node.attributes.TargetMode,\n                    };\n                    if (emitHyperlinks) {\n                      this.emit('hyperlink', relationship);\n                    } else {\n                      hyperlinks[relationship.rId] = relationship;\n                    }\n                  }\n                  break;\n\n                default:\n                  break;\n              }\n            }\n          }\n        }\n      }\n      this.emit('finished');\n    } catch (error) {\n      this.emit('error', error);\n    }\n  }\n}\n\nmodule.exports = HyperlinkReader;\n"],"file":"hyperlink-reader.js"}